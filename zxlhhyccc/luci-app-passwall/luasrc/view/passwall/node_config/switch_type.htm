<%
local api = require "luci.passwall.api"
-%>
<div class="cbi-value" id="cbi-<%=self.config.."-"..section.."-"..self.option%>" data-index="<%=self.index%>" data-depends="<%=pcdata(self:deplist2json(section))%>">
	<label class="cbi-value-title">
		<%:Switch Type%>
	</label>
	<div class="cbi-value-field">
		<div>
			<input class="btn cbi-button cbi-button-apply" type="button" onclick="switch_type()" value="<%:Switch Type%>" />
		</div>
	</div>
</div>

<script>
	function getOption(opt) {
		var obj;
		var id = 'cbid.passwall.<%=section%>.' + opt;
		obj = document.getElementsByName(id)[0] || document.getElementById(id);
		if (obj) {
			var combobox = document.getElementById('cbi.combobox.' + id);
			if (combobox) {
				obj.combobox = combobox;
			}
			var div = document.getElementById(id);
			if (div && div.getElementsByTagName("li").length > 0) {
				obj = div;
			}
			return obj;
		} else {
			return null;
		}
	}
	function switch_type() {
		XHR.get('<%=api.url("update_node")%>', {
			id: "<%=section%>",
			data: JSON.stringify({
				type: getOption("type").value
			})
		},
		function(x, data) {
			if (x && x.status == 200 && data.code == 1) {
				window.location.reload();
			}
			else {
				alert("<%:Error%>");
			}
		});
	}
</script>
